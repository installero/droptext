<div class="flex flex-col h-full">
  <h1 class="text-2xl mb-4"><%= t('.write_something')%></h1>

  <%= form_with model: @snippet, class: 'grow flex flex-col relative', id: :snippet_form,
    data: { turbo: false } do |form| %>
    <%= form.text_area :body,
      required: true,
      class: 'block w-full px-3 py-1.5 border border-solid border-gray-700
      bg-slate-700 focus:text-slate-100 focus:bg-slate-800
      font-mono focus:border-gray-800 focus:outline-none transition duration-150
      ease-in-out grow' %>

    <div class="text-slate-700 text-xs pb-1 absolute bottom-20 left-2.5 z-50">
      This site is protected by reCAPTCHA and the Google
      <a href="https://policies.google.com/privacy">Privacy Policy</a> and
      <a href="https://policies.google.com/terms">Terms of Service</a> apply.
    </div>

    <%= form.select :language, enum_options_for_select(@snippet.class, :language), { selected: 'auto' }, { data: { no_results: t('.no_results'), item_select: t('.item_select'), locale: locale } } %>

    <%= form.hidden_field :recaptcha_token %>
  <% end %>

  <div class="mt-5" data-controller="snippets">
    <button class="btn btn-emerald" type="button" data-action="click->snippets#submitForm"><%= t('.save')%></button>
  </div>

  <%= render 'unsafe_confirm_modal' %>
</div>

<script src="https://www.google.com/recaptcha/api.js?render=<%= ENV['RECAPTCHA_SITE_KEY'] %>"></script>

<script>
  grecaptcha.ready(() => {
    grecaptcha.execute(
      '<%= ENV['RECAPTCHA_SITE_KEY'] %>',
      {
        action: 'callback'
      }
    ).then(token => {
      document.querySelector('input[name="snippet[recaptcha_token]"]').value = token
    })
  })
</script>
